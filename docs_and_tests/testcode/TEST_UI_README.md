# UI é›†æˆæµ‹è¯•æŒ‡å—

æœ¬ç›®å½•åŒ…å«ç”¨äºæµ‹è¯•é›†æˆåˆ° `splitlearn-comm` åŒ…ä¸­çš„ Gradio UI åŠŸèƒ½çš„æµ‹è¯•è„šæœ¬ã€‚

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶æ¦‚è§ˆ

### 1. `test_ui_integration.py` - å®Œæ•´æ€§æ£€æŸ¥ âœ…

**ç”¨é€”**: éªŒè¯æ‰€æœ‰ UI ç»„ä»¶éƒ½æ­£ç¡®é›†æˆåˆ° splitlearn-comm åŒ…ä¸­

**æµ‹è¯•å†…å®¹**:
- âœ“ å¯¼å…¥æ£€æŸ¥ (ClientUI, ServerMonitoringUI)
- âœ“ å®¢æˆ·ç«¯æ–¹æ³• (GRPCComputeClient.launch_ui)
- âœ“ æœåŠ¡å™¨æ–¹æ³• (GRPCComputeServer.launch_monitoring_ui)
- âœ“ Servicer æŒ‡æ ‡æ”¶é›† (get_metrics, history_size)
- âœ“ UI ç»„ä»¶ (themes, StatsPanel, DEFAULT_CSS)
- âœ“ ä¾èµ–é…ç½® (pyproject.toml)

**è¿è¡Œ**:
```bash
python testcode/test_ui_integration.py
```

**é¢„æœŸç»“æœ**:
```
æ€»è®¡: 6/6 æµ‹è¯•é€šè¿‡
âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼
```

---

### 2. `test_server_ui_integrated.py` - æœåŠ¡å™¨ç›‘æ§ UI

**ç”¨é€”**: æµ‹è¯•é›†æˆçš„æœåŠ¡å™¨ç›‘æ§ UI åŠŸèƒ½

**åŠŸèƒ½**:
- å¯åŠ¨ gRPC æœåŠ¡å™¨ (port 50053)
- åŠ è½½ Trunk æ¨¡å‹
- å¯åŠ¨ç›‘æ§ UI (port 7861)
- å®æ—¶æ˜¾ç¤ºæœåŠ¡å™¨ç»Ÿè®¡ã€è¯·æ±‚å†å²å’Œè®¡ç®—æ—¶é—´è¶‹åŠ¿

**è¿è¡Œ**:
```bash
python testcode/test_server_ui_integrated.py
```

**è®¿é—®**:
- ç›‘æ§ UI: http://127.0.0.1:7861
- gRPC æœåŠ¡å™¨: localhost:50053

**UI åŠŸèƒ½**:
- ğŸ“Š å®æ—¶æœåŠ¡å™¨ç»Ÿè®¡
- ğŸ“‹ è¯·æ±‚å†å²è¡¨æ ¼
- ğŸ“‰ è®¡ç®—æ—¶é—´è¶‹åŠ¿å›¾
- ğŸ”„ è‡ªåŠ¨åˆ·æ–° (æ¯ 2 ç§’)

---

### 3. `test_client_ui_integrated.py` - å®¢æˆ·ç«¯ UI

**ç”¨é€”**: æµ‹è¯•é›†æˆçš„å®¢æˆ·ç«¯ UI åŠŸèƒ½

**åŠŸèƒ½**:
- è¿æ¥åˆ° gRPC æœåŠ¡å™¨
- åŠ è½½ Bottom å’Œ Top æ¨¡å‹
- å¯åŠ¨äº¤äº’å¼æ–‡æœ¬ç”Ÿæˆ UI (port 7860)

**å‰ç½®æ¡ä»¶**:
- å¿…é¡»å…ˆå¯åŠ¨æœåŠ¡å™¨ (`test_server_ui_integrated.py`)

**è¿è¡Œ**:
```bash
# Terminal 1: å¯åŠ¨æœåŠ¡å™¨
python testcode/test_server_ui_integrated.py

# Terminal 2: å¯åŠ¨å®¢æˆ·ç«¯ UI
python testcode/test_client_ui_integrated.py
```

**è®¿é—®**:
- å®¢æˆ·ç«¯ UI: http://127.0.0.1:7860

**UI åŠŸèƒ½**:
- ğŸ“ äº¤äº’å¼æ–‡æœ¬ç”Ÿæˆ
- â¹ï¸ åœæ­¢ç”ŸæˆæŒ‰é’®
- ğŸ›ï¸ å‚æ•°æ§åˆ¶ (max_length, temperature, top_k)
- ğŸ“ˆ å®æ—¶ç»Ÿè®¡ (tokens/s, å»¶è¿Ÿ)
- ğŸ’¡ ç¤ºä¾‹ Prompts

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å‡†å¤‡æ¨¡å‹

å¦‚æœè¿˜æ²¡æœ‰æ¨¡å‹æ–‡ä»¶ï¼Œå…ˆè¿è¡Œï¼š

```bash
python testcode/prepare_models.py
```

è¿™å°†ä¸‹è½½å¹¶æ‹†åˆ† GPT-2 æ¨¡å‹ï¼ˆçº¦ 500MBï¼‰ã€‚

### æ­¥éª¤ 2: è¿è¡Œé›†æˆæµ‹è¯•

éªŒè¯æ‰€æœ‰ç»„ä»¶éƒ½æ­£ç¡®é›†æˆï¼š

```bash
python testcode/test_ui_integration.py
```

åº”è¯¥çœ‹åˆ°ï¼š
```
æ€»è®¡: 6/6 æµ‹è¯•é€šè¿‡
âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼
```

### æ­¥éª¤ 3: æµ‹è¯•æœåŠ¡å™¨ç›‘æ§ UI

**Terminal 1**:
```bash
python testcode/test_server_ui_integrated.py
```

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://127.0.0.1:7861

ä½ ä¼šçœ‹åˆ°ï¼š
- æœåŠ¡å™¨ç»Ÿè®¡ä»ªè¡¨æ¿
- è¯·æ±‚å†å²è®°å½•
- è®¡ç®—æ—¶é—´è¶‹åŠ¿å›¾

### æ­¥éª¤ 4: æµ‹è¯•å®¢æˆ·ç«¯ UI

**Terminal 2** (ä¿æŒ Terminal 1 çš„æœåŠ¡å™¨è¿è¡Œ):
```bash
python testcode/test_client_ui_integrated.py
```

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://127.0.0.1:7860

ä½ ä¼šçœ‹åˆ°ï¼š
- æ–‡æœ¬ç”Ÿæˆç•Œé¢
- å‚æ•°æ§åˆ¶æ»‘å—
- å®æ—¶ç”Ÿæˆç»Ÿè®¡

### æ­¥éª¤ 5: å®Œæ•´æµ‹è¯•æµç¨‹

1. åœ¨å®¢æˆ·ç«¯ UI è¾“å…¥ä¸€ä¸ª promptï¼Œä¾‹å¦‚ "The future of AI is"
2. ç‚¹å‡» "å¼€å§‹ç”Ÿæˆ"
3. è§‚å¯Ÿå®æ—¶ç”Ÿæˆçš„æ–‡æœ¬
4. åˆ‡æ¢åˆ°æœåŠ¡å™¨ç›‘æ§ UI (http://127.0.0.1:7861)
5. æŸ¥çœ‹æ–°çš„è¯·æ±‚è®°å½•å’Œç»Ÿè®¡æ›´æ–°

---

## ğŸ“¦ ä¾èµ–è¦æ±‚

æ‰€æœ‰æµ‹è¯•éƒ½éœ€è¦è¿™äº›ä¾èµ–ï¼š

```bash
# æ ¸å¿ƒä¾èµ–ï¼ˆå·²å®‰è£…ï¼‰
torch
grpcio
protobuf
transformers

# UI ä¾èµ–ï¼ˆéœ€è¦å®‰è£…ï¼‰
gradio>=3.50.0
pandas>=1.5.0
```

**å®‰è£… UI ä¾èµ–**:

```bash
# æ–¹æ³• 1: ç›´æ¥å®‰è£…
pip install gradio pandas

# æ–¹æ³• 2: ä½¿ç”¨ optional-dependencies
cd splitlearn-comm
pip install -e .[ui]

# æ–¹æ³• 3: å®‰è£…æ‰€æœ‰å¯é€‰ä¾èµ–
pip install -e .[all]
```

---

## âœ¨ æ–°é›†æˆåŠŸèƒ½äº®ç‚¹

### ä»£ç ç®€åŒ–

**ä¹‹å‰ (testcode/client_with_gradio.py)**:
```python
# 366 è¡Œä»£ç 
# éœ€è¦æ‰‹åŠ¨å®ç°æ‰€æœ‰ UI é€»è¾‘
```

**ç°åœ¨ (ä½¿ç”¨é›†æˆ UI)**:
```python
# ä»…éœ€ 15 è¡Œä»£ç ï¼
from splitlearn_comm import GRPCComputeClient
import torch

client = GRPCComputeClient("localhost:50053")
client.connect()

bottom = torch.load("bottom.pt")
top = torch.load("top.pt")
tokenizer = AutoTokenizer.from_pretrained("gpt2")

client.launch_ui(bottom, top, tokenizer)
```

**ä»£ç å‡å°‘: 96% (366 è¡Œ â†’ 15 è¡Œ)**

### æ–°å¢æ–¹æ³•

#### å®¢æˆ·ç«¯

```python
client.launch_ui(
    bottom_model=bottom,
    top_model=top,
    tokenizer=tokenizer,
    theme="default",      # "default", "dark", "light"
    share=False,
    server_port=7860
)
```

#### æœåŠ¡å™¨

```python
server.launch_monitoring_ui(
    theme="default",
    refresh_interval=2,   # ç§’
    share=False,
    server_port=7861,
    blocking=False        # åå°è¿è¡Œ
)
```

---

## ğŸ¨ ä¸»é¢˜é€‰é¡¹

ä¸‰ç§å†…ç½®ä¸»é¢˜ï¼š

1. **default**: æŸ”å’Œçš„è“è‰²ä¸»é¢˜ï¼ˆæ¨èï¼‰
2. **dark**: æ·±è‰²æ¨¡å¼
3. **light**: æµ…è‰²æ¨¡å¼

ç¤ºä¾‹ï¼š
```python
client.launch_ui(..., theme="dark")
server.launch_monitoring_ui(..., theme="dark")
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ 1: "No module named 'gradio'"

**è§£å†³**:
```bash
pip install gradio pandas
```

### é—®é¢˜ 2: "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨"

**è§£å†³**:
ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š
```bash
python testcode/test_server_ui_integrated.py
```

### é—®é¢˜ 3: "ç«¯å£å·²è¢«å ç”¨"

**è§£å†³**:
æ›´æ”¹ç«¯å£ï¼š
```python
client.launch_ui(..., server_port=7870)
server.launch_monitoring_ui(..., server_port=7871)
```

### é—®é¢˜ 4: "æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨"

**è§£å†³**:
```bash
python testcode/prepare_models.py
```

---

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

### é›†æˆæµ‹è¯•æˆåŠŸè¾“å‡º

```
======================================================================
splitlearn-comm UI é›†æˆæµ‹è¯•
======================================================================

======================================================================
æµ‹è¯•ç»“æœæ‘˜è¦
======================================================================
å¯¼å…¥æ£€æŸ¥                : âœ… é€šè¿‡
å®¢æˆ·ç«¯æ–¹æ³•               : âœ… é€šè¿‡
æœåŠ¡å™¨æ–¹æ³•               : âœ… é€šè¿‡
Servicer æŒ‡æ ‡         : âœ… é€šè¿‡
UI ç»„ä»¶               : âœ… é€šè¿‡
ä¾èµ–é…ç½®                : âœ… é€šè¿‡

======================================================================
æ€»è®¡: 6/6 æµ‹è¯•é€šè¿‡
======================================================================

âœ… æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼
```

### æœåŠ¡å™¨ UI å¯åŠ¨æˆåŠŸ

```
======================================================================
æµ‹è¯•é›†æˆçš„æœåŠ¡å™¨ç›‘æ§ UI (splitlearn-comm)
======================================================================

âœ“ æ¨¡å‹æ–‡ä»¶å­˜åœ¨
  Trunk: 224.5 MB

âœ“ æ¨¡å‹åŠ è½½å®Œæˆ
âœ“ æœåŠ¡å™¨å·²å¯åŠ¨ (localhost:50053)

======================================================================
å¯åŠ¨ç›‘æ§ UI
======================================================================

ğŸš€ ä½¿ç”¨é›†æˆçš„ launch_monitoring_ui() æ–¹æ³•...
   ç›‘æ§åœ°å€: http://127.0.0.1:7861
   æœåŠ¡å™¨åœ°å€: localhost:50053
```

### å®¢æˆ·ç«¯ UI å¯åŠ¨æˆåŠŸ

```
======================================================================
æµ‹è¯•é›†æˆçš„å®¢æˆ·ç«¯ UI (splitlearn-comm)
======================================================================

âœ“ æ¨¡å‹æ–‡ä»¶å­˜åœ¨
  Bottom: 206.3 MB
  Top: 203.4 MB

âœ“ æ¨¡å‹åŠ è½½å®Œæˆ
âœ“ å·²è¿æ¥åˆ°æœåŠ¡å™¨

======================================================================
å¯åŠ¨ Gradio UI
======================================================================

ğŸš€ ä½¿ç”¨é›†æˆçš„ launch_ui() æ–¹æ³•...
   è®¿é—®åœ°å€: http://127.0.0.1:7860

âœ¨ è¿™æ˜¯é›†æˆåˆ° splitlearn-comm åŒ…ä¸­çš„æ–° UI åŠŸèƒ½
   ä»£ç ä» 366 è¡Œå‡å°‘åˆ° 15 è¡Œ (96% å‡å°‘)
```

---

## ğŸ“ å¯¹æ¯”ï¼šæ—§æ–¹æ³• vs æ–°æ–¹æ³•

### æ—§æ–¹æ³• (testcode/client_with_gradio.py)

**ç¼ºç‚¹**:
- âŒ 366 è¡Œä»£ç 
- âŒ éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ UI é€»è¾‘
- âŒ ä»£ç é‡å¤
- âŒ éš¾ä»¥å¤ç”¨

### æ–°æ–¹æ³• (é›†æˆ UI)

**ä¼˜ç‚¹**:
- âœ… 15 è¡Œä»£ç  (96% å‡å°‘)
- âœ… å†…ç½®åˆ°åŒ…ä¸­ï¼Œå¼€ç®±å³ç”¨
- âœ… ç»Ÿä¸€çš„ API
- âœ… æ˜“äºç»´æŠ¤å’Œå‡çº§
- âœ… å¯é€‰ä¾èµ–ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹**
   - æŒ‰ç…§"å¿«é€Ÿå¼€å§‹"éƒ¨åˆ†çš„æ­¥éª¤æ“ä½œ
   - éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

2. **ä½“éªŒæ–°åŠŸèƒ½**
   - å°è¯•ä¸åŒçš„ä¸»é¢˜
   - è°ƒæ•´ç”Ÿæˆå‚æ•°
   - è§‚å¯ŸæœåŠ¡å™¨ç›‘æ§æ•°æ®

3. **é›†æˆåˆ°ä½ çš„é¡¹ç›®**
   - ä½¿ç”¨ `client.launch_ui()` ç®€åŒ–å®¢æˆ·ç«¯ä»£ç 
   - ä½¿ç”¨ `server.launch_monitoring_ui()` æ·»åŠ ç›‘æ§

4. **æä¾›åé¦ˆ**
   - æŠ¥å‘Šé—®é¢˜æˆ–å»ºè®®
   - è´¡çŒ®æ”¹è¿›

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **é›†æˆ UI README**: `splitlearn-comm/examples/UI_README.md`
- **å®¢æˆ·ç«¯ç¤ºä¾‹**: `splitlearn-comm/examples/client_ui_example.py`
- **æœåŠ¡å™¨ç¤ºä¾‹**: `splitlearn-comm/examples/server_ui_example.py`
- **åŸå§‹ Gradio åº”ç”¨**: `testcode/client_with_gradio.py` (å‚è€ƒç”¨)

---

## ğŸ‰ æ€»ç»“

é›†æˆçš„ UI åŠŸèƒ½æä¾›äº†ï¼š

1. **ç®€æ´çš„ API**: ä¸€è¡Œä»£ç å¯åŠ¨ UI
2. **å¼ºå¤§çš„åŠŸèƒ½**: å®Œæ•´çš„ç”Ÿæˆå’Œç›‘æ§èƒ½åŠ›
3. **çµæ´»çš„é…ç½®**: ä¸»é¢˜ã€ç«¯å£ã€åˆ·æ–°é—´éš”ç­‰
4. **é›¶ç ´åæ€§**: å¯é€‰ä¾èµ–ï¼Œä¸å½±å“ç°æœ‰ä»£ç 
5. **ç”Ÿäº§å°±ç»ª**: ç»è¿‡å®Œæ•´æµ‹è¯•å’ŒéªŒè¯

å¼€å§‹äº«å—ç®€åŒ–çš„ Split Learning UI å¼€å‘ä½“éªŒå§ï¼ğŸš€
